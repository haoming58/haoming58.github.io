---
layout: default
---

<div class="note-page-wrapper">
  <div class="note-container">
    <button class="mobile-toc-toggle hidden" onclick="toggleSidebar()">Menu</button>
    
    <div class="note-sidebar" id="sidebar">
      <div class="note-toc">
        <h3>Table of Contents</h3>
        <div id="toc-content">
          <!-- TOC will be generated by JavaScript -->
        </div>
      </div>
    </div>
    
    <div class="note-content">
      <article class="note-article">
        {{ content }}
      </article>
    </div>
  </div>
</div>

<style>
/* Override default container constraints for note pages */
.note-page-wrapper {
  width: 100%;
  max-width: none;
  margin: 0;
  padding: 0;
}

/* Break out of parent container */
.post > .note-page-wrapper,
.container > .note-page-wrapper {
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
}

.note-container {
  display: flex;
  width: 100%;
  min-height: 100vh;
  margin: 0;
  padding: 0;
  gap: 0;
  position: relative;
}

.note-sidebar {
  flex: 0 0 280px;
  position: fixed;
  top: 0;
  left: 0;
  width: 280px;
  height: 100vh;
  overflow-y: auto;
  background: var(--global-bg-color);
  border-right: 2px solid var(--global-divider-color);
  z-index: 100;
  padding-top: 80px;
  scrollbar-width: thin;
  scrollbar-color: var(--global-theme-color) transparent;
  box-shadow: 2px 0 12px var(--global-divider-color);
}

.note-sidebar::-webkit-scrollbar {
  width: 6px;
}

.note-sidebar::-webkit-scrollbar-track {
  background: transparent;
}

.note-sidebar::-webkit-scrollbar-thumb {
  background: var(--global-theme-color);
  border-radius: 3px;
}

.note-toc {
  background: var(--global-bg-color);
  border: none;
  border-radius: 0;
  padding: 1.5rem;
  box-shadow: none;
  height: 100%;
}

.note-toc h3 {
  margin: 0 0 1.5rem 0;
  color: var(--global-theme-color);
  font-size: 1.15rem;
  font-weight: 700;
  border-bottom: 2px solid var(--global-theme-color);
  padding-bottom: 0.75rem;
  letter-spacing: -0.01em;
  position: relative;
}

.note-toc h3::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 50px;
  height: 2px;
  background: var(--global-theme-color);
  box-shadow: 0 0 8px rgba(71, 85, 105, 0.5);
}

.note-toc ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.note-toc li {
  margin: 0.5rem 0;
}

.note-toc a {
  display: block;
  padding: 0.65rem 0.85rem;
  color: var(--global-text-color);
  text-decoration: none;
  border-radius: 8px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 0.9rem;
  line-height: 1.5;
  position: relative;
  border-left: 3px solid transparent;
}

.note-toc a::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 3px;
  height: 0;
  background: var(--global-theme-color);
  transition: height 0.3s ease;
  border-radius: 0 2px 2px 0;
}

.note-toc a:hover {
  background: var(--global-divider-color);
  color: var(--global-theme-color);
  transform: translateX(4px);
  border-left-color: var(--global-theme-color);
}

.note-toc a:hover::before {
  height: 100%;
}

.note-toc a.active {
  background: var(--global-divider-color);
  color: var(--global-theme-color);
  font-weight: 600;
  border-left-color: var(--global-theme-color);
}

.note-toc a.active::before {
  height: 100%;
}

.note-toc .toc-level-1 {
  padding-left: 0.75rem;
}

.note-toc .toc-level-2 {
  padding-left: 1.5rem;
  font-size: 0.85rem;
  color: var(--global-text-color-light);
}

.note-toc .toc-level-3 {
  padding-left: 2.25rem;
  font-size: 0.8rem;
  color: var(--global-text-color-light);
}

/* Back link styles */
.note-toc .back-link {
  color: var(--global-theme-color) !important;
  font-weight: 600 !important;
  border-bottom: 1px solid var(--global-theme-color);
  padding-bottom: 0.2rem;
}

.note-toc .back-link:hover {
  background: var(--global-theme-color) !important;
  color: white !important;
  border-radius: 4px;
  padding: 0.3rem 0.5rem;
  margin: -0.3rem -0.5rem;
}

.note-content {
  flex: 1;
  margin-left: 280px;
  width: calc(100% - 280px);
  min-height: 100vh;
  padding-top: 80px;
  padding-left: 2.5rem;
  padding-right: 2.5rem;
  padding-bottom: 4rem;
  box-sizing: border-box;
  overflow-x: hidden;
}

.note-article {
  background: var(--global-bg-color);
  border-radius: 0;
  padding: 2rem;
  box-shadow: none;
  max-width: 1200px !important;
  width: 100% !important;
  margin: 0 auto !important;
  box-sizing: border-box;
  font-size: 18px;
  line-height: 1.85;
}

/* Text content should have comfortable reading width */
.note-article p,
.note-article ul,
.note-article ol,
.note-article blockquote {
  max-width: 100%;
}

/* Math formulas and code blocks can be wider */
.note-article .MathJax_Display,
.note-article .mathjax,
.note-article pre,
.note-article .highlight {
  max-width: 100%;
  overflow-x: auto;
}

.note-article code {
  word-wrap: break-word;
}

.note-article pre code {
  word-wrap: normal;
}

/* Images should be responsive */
.note-article img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 1rem auto;
}

/* Tables should be responsive */
.note-article table {
  width: 100%;
  max-width: 100%;
  table-layout: auto;
  overflow-x: auto;
  display: block;
}

.note-article h1,
.note-article h2,
.note-article h3,
.note-article h4,
.note-article h5,
.note-article h6 {
  scroll-margin-top: 2rem;
  font-weight: 600;
  line-height: 1.4;
}

.note-article h1 {
  font-size: 2.2em;
  margin-top: 1.5em;
  margin-bottom: 0.8em;
  color: var(--global-theme-color);
  position: relative;
  padding-bottom: 0.5em;
}

.note-article h1::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 60px;
  height: 3px;
  background: linear-gradient(90deg, var(--global-theme-color) 0%, transparent 100%);
  border-radius: 2px;
}

.note-article h2 {
  font-size: 1.8em;
  margin-top: 1.3em;
  margin-bottom: 0.7em;
  color: var(--global-theme-color);
  position: relative;
  padding-left: 0.75em;
}

.note-article h2::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0.2em;
  width: 4px;
  height: 1em;
  background: var(--global-theme-color);
  border-radius: 2px;
}

.note-article h3 {
  font-size: 1.4em;
  margin-top: 1.2em;
  margin-bottom: 0.6em;
  color: var(--global-text-color);
}


/* Mobile responsiveness */
@media (max-width: 768px) {
  .note-sidebar {
    position: fixed;
    top: 0;
    left: -300px;
    width: 280px;
    height: 100vh;
    transition: left 0.3s ease;
    z-index: 1000;
    padding-top: 70px;
    box-shadow: 2px 0 10px var(--global-divider-color);
  }
  
  .note-sidebar.open {
    left: 0;
  }
  
  .note-content {
    margin-left: 0;
    width: 100%;
    padding-top: 70px;
    padding-left: 1rem;
    padding-right: 1rem;
    padding-bottom: 2rem;
  }
  
  .note-article {
    padding: 1rem;
    max-width: 100% !important;
  }
  
  /* Add toggle button for mobile */
  .mobile-toc-toggle {
    position: fixed;
    top: 70px;
    left: 0.5rem;
    z-index: 1001;
    background: var(--global-theme-color);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    display: block;
    font-size: 0.9rem;
    box-shadow: 0 2px 8px var(--global-divider-color);
  }
  
  .mobile-toc-toggle.hidden {
    display: none;
  }
  
  /* Close sidebar when clicking outside */
  .note-sidebar.open ~ .note-content::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 999;
  }
}

/* Smooth scrolling and prevent horizontal overflow */
html {
  scroll-behavior: smooth;
  overflow-x: hidden;
}

body {
  overflow-x: hidden;
}

/* Ensure the note container isn't constrained by parent */
.note-container,
.note-container * {
  box-sizing: border-box;
}

/* Hide mobile toggle on desktop */
@media (min-width: 769px) {
  .mobile-toc-toggle {
    display: none !important;
  }
}
</style>

<script>
// Mobile sidebar toggle function
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  sidebar.classList.toggle('open');
}

// Close sidebar when clicking outside
function closeSidebar(event) {
  const sidebar = document.getElementById('sidebar');
  const toggle = document.querySelector('.mobile-toc-toggle');
  
  if (sidebar.classList.contains('open') && 
      !sidebar.contains(event.target) && 
      !toggle.contains(event.target)) {
    sidebar.classList.remove('open');
  }
}

// Show/hide mobile toggle button based on screen size
function updateMobileToggle() {
  const toggle = document.querySelector('.mobile-toc-toggle');
  if (toggle) {
    if (window.innerWidth <= 768) {
      toggle.classList.remove('hidden');
    } else {
      toggle.classList.add('hidden');
    }
  }
}

// Update on resize
window.addEventListener('resize', updateMobileToggle);

// Close sidebar when clicking outside (mobile only)
document.addEventListener('click', function(event) {
  if (window.innerWidth <= 768) {
    closeSidebar(event);
  }
});

// Function to return to the correct category page
function returnToCategory() {
  // Store the current category in sessionStorage when navigating to a note
  const currentCategory = sessionStorage.getItem('currentCategory');
  if (currentCategory) {
    // Navigate to notes page and show the specific category
    window.location.href = '/notes/';
    // The notes page will automatically show the category if it's in sessionStorage
  } else {
    // Fallback to notes index
    window.location.href = '/notes/';
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // Initialize mobile toggle visibility
  updateMobileToggle();
  
  // Check if this is a notes page (not the main notes index)
  const isNotesPage = window.location.pathname.includes('/notes/') && window.location.pathname !== '/notes/';
  
  // Get the category from the current note page
  let noteCategory = null;
  if (isNotesPage) {
    // Try to get category from the page content
    const categoryElement = document.querySelector('meta[name="category"]');
    if (categoryElement) {
      noteCategory = categoryElement.getAttribute('content');
    } else {
      // Try to get category from the page title or content
      const pageTitle = document.querySelector('h1, .note-article h1');
      if (pageTitle) {
        // This is a workaround - we'll use a generic return to notes
        noteCategory = 'unknown';
      }
    }
  }
  
  // Generate TOC from headings for note content
  const headings = document.querySelectorAll('.note-article h1, .note-article h2, .note-article h3, .note-article h4, .note-article h5, .note-article h6');
  const tocContent = document.getElementById('toc-content');
  
  if (headings.length === 0) {
    if (!isNotesPage) {
      tocContent.innerHTML = '<p style="color: var(--global-text-color-light); font-size: 0.9rem;">No headings found</p>';
    } else {
      // For individual note pages without headings, just show back button
      let tocHTML = '<ul>';
      // Return to notes index page (category view)
      tocHTML += '<li><a href="/notes/" class="toc-level-1 back-link" onclick="returnToCategory()">← 返回上一级</a></li>';
      tocHTML += '</ul>';
      tocContent.innerHTML = tocHTML;
    }
    return;
  }
  
  let tocHTML = '<ul>';
  
  // Add back button for individual notes
  if (isNotesPage) {
    // Return to notes index page (category view)
    tocHTML += '<li><a href="/notes/" class="toc-level-1 back-link" onclick="returnToCategory()">← 返回上一级</a></li>';
  }
  
  let currentLevel = 0;
  
  headings.forEach((heading, index) => {
    const level = parseInt(heading.tagName.charAt(1));
    const id = heading.id || `heading-${index}`;
    
    // Add id if not present
    if (!heading.id) {
      heading.id = id;
    }
    
    // Close previous levels if current level is higher
    if (level > currentLevel) {
      for (let i = currentLevel; i < level; i++) {
        tocHTML += '<ul>';
      }
    } else if (level < currentLevel) {
      for (let i = currentLevel; i > level; i--) {
        tocHTML += '</ul></li>';
      }
    } else if (index > 0) {
      tocHTML += '</li>';
    }
    
    // Add current heading
    tocHTML += `<li><a href="#${id}" class="toc-level-${level}">${heading.textContent}</a>`;
    currentLevel = level;
  });
  
  // Close remaining levels
  for (let i = currentLevel; i > 0; i--) {
    tocHTML += '</li></ul>';
  }
  
  if (!isNotesPage) {
    tocContent.innerHTML = tocHTML;
  } else {
    // For individual notes, append headings to existing TOC
    const existingTOC = tocContent.innerHTML;
    tocContent.innerHTML = existingTOC + tocHTML;
  }
  
  // Add click handlers for smooth scrolling
  const tocLinks = tocContent.querySelectorAll('a[href^="#"]');
  tocLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.getAttribute('href').substring(1);
      const targetElement = document.getElementById(targetId);
      
      if (targetElement) {
        targetElement.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
        
        // Update active link
        tocLinks.forEach(l => l.classList.remove('active'));
        this.classList.add('active');
      }
    });
  });
  
  // Highlight current section on scroll
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const id = entry.target.id;
        const activeLink = tocContent.querySelector(`a[href="#${id}"]`);
        if (activeLink) {
          tocLinks.forEach(l => l.classList.remove('active'));
          activeLink.classList.add('active');
        }
      }
    });
  }, {
    rootMargin: '-20% 0px -70% 0px'
  });
  
  headings.forEach(heading => {
    observer.observe(heading);
  });
});
</script>
